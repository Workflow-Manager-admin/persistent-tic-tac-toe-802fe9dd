{"is_source_file": true, "format": "Python", "description": "This file implements the backend API for a multiplayer Tic Tac Toe game using FastAPI. It includes user registration and login, game creation, joining, state retrieval, moves, leaderboard, and game history functionalities.", "external_files": ["fastapi", "fastapi.middleware.cors", "fastapi.security", "pydantic", "uuid", "datetime", "passlib.context", "secrets"], "external_methods": ["FastAPI", "HTTPException", "Depends", "status", "CORSMiddleware", "OAuth2PasswordBearer", "OAuth2PasswordRequestForm", "BaseModel", "Field", "uuid4", "datetime.utcnow", "CryptContext", "secrets.token_urlsafe"], "published": ["app", "register", "login", "create_game", "join_game", "get_game_state", "make_move", "leaderboard", "game_history", "health_check"], "classes": [{"name": "UserRegister", "description": "Model for user registration data including username and password"}, {"name": "User", "description": "Basic model for user data containing username only"}, {"name": "TokenResponse", "description": "Response model containing access token and token type"}, {"name": "GameCreateRequest", "description": "Model for request to create a new game, including optional board size"}, {"name": "GameState", "description": "Representation of current game state, including board, players, turn, winner, status, and creation time"}, {"name": "JoinGameRequest", "description": "Request model for joining an existing game by ID"}, {"name": "MoveRequest", "description": "Model for move submission, specifying position"}, {"name": "LeaderboardEntry", "description": "Entry in leaderboard showing username and wins"}, {"name": "GameHistoryEntry", "description": "Record of a game in user's history including result"}], "methods": [{"name": "str hash_password(password: str)", "description": "Hashes password using bcrypt", "scope": "", "scopeKind": ""}, {"name": "bool verify_password(plain_password: str, hashed_password: str)", "description": "Verifies a plain password against a hashed password", "scope": "", "scopeKind": ""}, {"name": "dict authenticate_user(token: str = Depends(oauth2_scheme))", "description": "Decodes token and retrieves user; raises 401 if invalid", "scope": "", "scopeKind": ""}, {"name": "register(user: UserRegister)", "description": "Registers a new user and initializes leaderboard", "scope": "", "scopeKind": ""}, {"name": "login(form_data: OAuth2PasswordRequestForm = Depends())", "description": "Authenticates user credentials and issues a token", "scope": "", "scopeKind": ""}, {"name": "create_game(game_req: GameCreateRequest, user=Depends(authenticate_user))", "description": "Creates a new game session with default empty board", "scope": "", "scopeKind": ""}, {"name": "join_game(join_req: JoinGameRequest, user=Depends(authenticate_user))", "description": "Sets a user as player O in an existing waiting game", "scope": "", "scopeKind": ""}, {"name": "get_game_state(game_id: str, user=Depends(authenticate_user))", "description": "Retrieves current state of specified game", "scope": "", "scopeKind": ""}, {"name": "make_move(move: MoveRequest, user=Depends(authenticate_user))", "description": "Submits a move, updates the board, and checks for win/draw", "scope": "", "scopeKind": ""}, {"name": "leaderboard()", "description": "Returns sorted list of users by victories", "scope": "", "scopeKind": ""}, {"name": "game_history(user=Depends(authenticate_user))", "description": "Lists the game history for the authenticated user", "scope": "", "scopeKind": ""}, {"name": "Optional[str] _check_winner(game)", "description": "Determines if a game has a winner based on current board", "scope": "", "scopeKind": ""}, {"name": "bool _is_draw(game)", "description": "Checks if the game is a draw (full board, no winner)", "scope": "", "scopeKind": ""}, {"name": "_game_to_state(game)", "description": "Converts internal game dict to GameState model for responses", "scope": "", "scopeKind": ""}, {"name": "health_check()", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["hash_password", "verify_password", "authenticate_user", "app.post('/register')", "app.post('/login')", "app.post('/game/create')", "app.post('/game/join')", "app.get('/game/{game_id}')", "app.post('/game/move')", "app.get('/leaderboard')", "app.get('/history')", "health_check", "_check_winner", "_is_draw", "_game_to_state"], "search-terms": ["FastAPI Tic Tac Toe backend", "user registration login", "game creation join move", "leaderboard stats", "game state retrieval", "game logic"], "state": 2, "file_id": 4, "knowledge_revision": 23, "git_revision": "40da562712797610c36b40ae8c1e2c36faf5b27b", "revision_history": [{"16": "4b26eb12a9accdaefae52f7191b110352f916127"}, {"20": "4b26eb12a9accdaefae52f7191b110352f916127"}, {"23": "40da562712797610c36b40ae8c1e2c36faf5b27b"}], "ctags": [{"_type": "tag", "name": "GAMES", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^GAMES: Dict[str, dict] = {}  # game_id -> game dict$/", "language": "Python", "typeref": "typename:Dict[str, dict]", "kind": "variable"}, {"_type": "tag", "name": "GameCreateRequest", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class GameCreateRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "GameHistoryEntry", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class GameHistoryEntry(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "GameState", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class GameState(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "JoinGameRequest", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class JoinGameRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "LEADERBOARD", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^LEADERBOARD: Dict[str, int] = {}  # username -> wins$/", "language": "Python", "typeref": "typename:Dict[str, int]", "kind": "variable"}, {"_type": "tag", "name": "LeaderboardEntry", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class LeaderboardEntry(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "MoveRequest", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class MoveRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "TOKENS", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^TOKENS: Dict[str, str] = {}  # token -> username$/", "language": "Python", "typeref": "typename:Dict[str, str]", "kind": "variable"}, {"_type": "tag", "name": "TokenResponse", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class TokenResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "USERS", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^USERS: Dict[str, dict] = {}  # username -> user data$/", "language": "Python", "typeref": "typename:Dict[str, dict]", "kind": "variable"}, {"_type": "tag", "name": "User", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class User(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "UserRegister", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class UserRegister(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_check_winner", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def _check_winner(game) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(game)"}, {"_type": "tag", "name": "_game_to_state", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def _game_to_state(game):$/", "language": "Python", "kind": "function", "signature": "(game)"}, {"_type": "tag", "name": "_is_draw", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def _is_draw(game) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(game)"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "authenticate_user", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def authenticate_user(token: str = Depends(oauth2_scheme)) -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "(token: str = Depends(oauth2_scheme))"}, {"_type": "tag", "name": "board_size", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    board_size: int = Field(default=3, description=\"Game board size, default 3x3\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "GameCreateRequest", "scopeKind": "class"}, {"_type": "tag", "name": "create_game", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def create_game(game_req: GameCreateRequest, user=Depends(authenticate_user)):$/", "language": "Python", "kind": "function", "signature": "(game_req: GameCreateRequest, user=Depends(authenticate_user))"}, {"_type": "tag", "name": "game_history", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def game_history(user=Depends(authenticate_user)):$/", "language": "Python", "kind": "function", "signature": "(user=Depends(authenticate_user))"}, {"_type": "tag", "name": "get_game_state", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def get_game_state(game_id: str, user=Depends(authenticate_user)):$/", "language": "Python", "kind": "function", "signature": "(game_id: str, user=Depends(authenticate_user))"}, {"_type": "tag", "name": "hash_password", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def hash_password(password: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(password: str)"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def health_check():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "join_game", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def join_game(join_req: JoinGameRequest, user=Depends(authenticate_user)):$/", "language": "Python", "kind": "function", "signature": "(join_req: JoinGameRequest, user=Depends(authenticate_user))"}, {"_type": "tag", "name": "leaderboard", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def leaderboard():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "login", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def login(form_data: OAuth2PasswordRequestForm = Depends()):$/", "language": "Python", "kind": "function", "signature": "(form_data: OAuth2PasswordRequestForm = Depends())"}, {"_type": "tag", "name": "make_move", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def make_move(move: MoveRequest, user=Depends(authenticate_user)):$/", "language": "Python", "kind": "function", "signature": "(move: MoveRequest, user=Depends(authenticate_user))"}, {"_type": "tag", "name": "oauth2_scheme", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^oauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"login\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "password", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    password: str = Field(..., min_length=6, description=\"Password (min 6 chars)\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "UserRegister", "scopeKind": "class"}, {"_type": "tag", "name": "pwd_context", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^pwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "register", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def register(user: UserRegister):$/", "language": "Python", "kind": "function", "signature": "(user: UserRegister)"}, {"_type": "tag", "name": "token_type", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    token_type: str = \"bearer\"$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "TokenResponse", "scopeKind": "class"}, {"_type": "tag", "name": "username", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    username: str = Field(..., min_length=3, max_length=30, description=\"Unique username\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "UserRegister", "scopeKind": "class"}, {"_type": "tag", "name": "verify_password", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def verify_password(plain_password: str, hashed_password: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(plain_password: str, hashed_password: str)"}], "hash": "77ab2248f62590a93730e24559a10720", "format-version": 4, "code-base-name": "tic_tac_toe_backend", "filename": "tic_tac_toe_backend/src/api/main.py", "fields": [{"name": "Dict[str, dict] GAMES", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str, int] LEADERBOARD", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str, str] TOKENS", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str, dict] USERS", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "int board_size", "scope": "GameCreateRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "oauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"login\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str password", "scope": "UserRegister", "scopeKind": "class", "description": "unavailable"}, {"name": "pwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str token_type", "scope": "TokenResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str username", "scope": "UserRegister", "scopeKind": "class", "description": "unavailable"}]}