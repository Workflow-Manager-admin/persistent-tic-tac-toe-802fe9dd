{"is_source_file": true, "format": "Python", "description": "Source code for a FastAPI backend API serving a multiplayer Tic Tac Toe game. It handles user registration, login, game creation, joining, moves, leaderboard, and user game history.", "external_files": ["fastapi", "fastapi.middleware.cors", "fastapi.security", "typing", "pydantic", "uuid", "datetime", "passlib"], "external_methods": ["FastAPI", "HTTPException", "Depends", "status", "Body", "CORSMiddleware", "OAuth2PasswordBearer", "OAuth2PasswordRequestForm", "BaseModel", "Field", "EmailStr", "ValidationError", "uuid4", "UUID", "datetime", "timedelta", "CryptContext", "secrets.token_urlsafe"], "published": ["app", "USERS", "TOKENS", "GAMES", "LEADERBOARD"], "classes": [{"name": "UserRegister", "description": "Model for user registration input, including username and password."}, {"name": "User", "description": "Model representing a user with just the username."}, {"name": "TokenResponse", "description": "Response model for authentication tokens."}, {"name": "GameCreateRequest", "description": "Model for game creation parameters."}, {"name": "GameState", "description": "Representation of the game's current state, including board, players, turn, winner, etc."}, {"name": "JoinGameRequest", "description": "Model for requesting to join an existing game."}, {"name": "MoveRequest", "description": "Model for submitting a move in a game, including position."}, {"name": "LeaderboardEntry", "description": "Model representing a user and their number of wins."}, {"name": "GameHistoryEntry", "description": "Model representing an entry in a user's game history, including game result."}], "methods": [{"name": "str hash_password(password: str)", "description": "Hashs a password using bcrypt.", "scope": "", "scopeKind": ""}, {"name": "bool verify_password(plain_password: str, hashed_password: str)", "description": "Verifies a plaintext password against a hashed password.", "scope": "", "scopeKind": ""}, {"name": "dict authenticate_user(token: str = Depends(oauth2_scheme))", "description": "Validates token, retrieves user. Raises exception if invalid.", "scope": "", "scopeKind": ""}, {"name": "register(user: UserRegister)", "description": "Creates a new user account with hashed password.", "scope": "", "scopeKind": ""}, {"name": "login(form_data: OAuth2PasswordRequestForm = Depends())", "description": "Authenticates user credentials and generates an access token.", "scope": "", "scopeKind": ""}, {"name": "create_game(game_req: GameCreateRequest, user=Depends(authenticate_user))", "description": "Creates a new game with a specified board size and assigns current user as Player X.", "scope": "", "scopeKind": ""}, {"name": "join_game(join_req: JoinGameRequest, user=Depends(authenticate_user))", "description": "Allows a user to join an existing waiting game as Player O.", "scope": "", "scopeKind": ""}, {"name": "get_game_state(game_id: str, user=Depends(authenticate_user))", "description": "Retrieves current game info and board state for a user participant.", "scope": "", "scopeKind": ""}, {"name": "make_move(move: MoveRequest, user=Depends(authenticate_user))", "description": "Processes a move made by a user, updates game state, checks for win/draw, updates leaderboard.", "scope": "", "scopeKind": ""}, {"name": "leaderboard()", "description": "Returns sorted list of top users by wins.", "scope": "", "scopeKind": ""}, {"name": "game_history(user=Depends(authenticate_user))", "description": "Retrieves the list of recent games for the current user with results.", "scope": "", "scopeKind": ""}, {"name": "Optional[str] _check_winner(game)", "description": "Helper to check if a game has a winner by inspecting rows, columns, diagonals.", "scope": "", "scopeKind": ""}, {"name": "bool _is_draw(game)", "description": "Checks if the game is a draw based on filled board with no winner.", "scope": "", "scopeKind": ""}, {"name": "_game_to_state(game)", "description": "Converts internal game dict to API response model.", "scope": "", "scopeKind": ""}, {"name": "health_check()", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["hash_password", "verify_password", "authenticate_user", "_check_winner", "_is_draw", "_game_to_state"], "search-terms": ["FastAPI", "Tic Tac Toe", "multiplayer game backend", "user authentication", "game management API", "leaderboard", "game state", "move handling"], "state": 2, "file_id": 4, "knowledge_revision": 20, "git_revision": "4b26eb12a9accdaefae52f7191b110352f916127", "revision_history": [{"16": "4b26eb12a9accdaefae52f7191b110352f916127"}, {"20": "4b26eb12a9accdaefae52f7191b110352f916127"}], "ctags": [{"_type": "tag", "name": "GAMES", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^GAMES: Dict[str, dict] = {}  # game_id -> game dict$/", "language": "Python", "typeref": "typename:Dict[str, dict]", "kind": "variable"}, {"_type": "tag", "name": "GameCreateRequest", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class GameCreateRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "GameHistoryEntry", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class GameHistoryEntry(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "GameState", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class GameState(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "JoinGameRequest", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class JoinGameRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "LEADERBOARD", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^LEADERBOARD: Dict[str, int] = {}  # username -> wins$/", "language": "Python", "typeref": "typename:Dict[str, int]", "kind": "variable"}, {"_type": "tag", "name": "LeaderboardEntry", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class LeaderboardEntry(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "MoveRequest", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class MoveRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "TOKENS", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^TOKENS: Dict[str, str] = {}  # token -> username$/", "language": "Python", "typeref": "typename:Dict[str, str]", "kind": "variable"}, {"_type": "tag", "name": "TokenResponse", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class TokenResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "USERS", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^USERS: Dict[str, dict] = {}  # username -> user data$/", "language": "Python", "typeref": "typename:Dict[str, dict]", "kind": "variable"}, {"_type": "tag", "name": "User", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class User(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "UserRegister", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class UserRegister(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_check_winner", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def _check_winner(game) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(game)"}, {"_type": "tag", "name": "_game_to_state", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def _game_to_state(game):$/", "language": "Python", "kind": "function", "signature": "(game)"}, {"_type": "tag", "name": "_is_draw", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def _is_draw(game) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(game)"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "authenticate_user", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def authenticate_user(token: str = Depends(oauth2_scheme)) -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "(token: str = Depends(oauth2_scheme))"}, {"_type": "tag", "name": "board_size", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    board_size: int = Field(default=3, description=\"Game board size, default 3x3\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "GameCreateRequest", "scopeKind": "class"}, {"_type": "tag", "name": "create_game", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def create_game(game_req: GameCreateRequest, user=Depends(authenticate_user)):$/", "language": "Python", "kind": "function", "signature": "(game_req: GameCreateRequest, user=Depends(authenticate_user))"}, {"_type": "tag", "name": "game_history", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def game_history(user=Depends(authenticate_user)):$/", "language": "Python", "kind": "function", "signature": "(user=Depends(authenticate_user))"}, {"_type": "tag", "name": "get_game_state", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def get_game_state(game_id: str, user=Depends(authenticate_user)):$/", "language": "Python", "kind": "function", "signature": "(game_id: str, user=Depends(authenticate_user))"}, {"_type": "tag", "name": "hash_password", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def hash_password(password: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(password: str)"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def health_check():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "join_game", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def join_game(join_req: JoinGameRequest, user=Depends(authenticate_user)):$/", "language": "Python", "kind": "function", "signature": "(join_req: JoinGameRequest, user=Depends(authenticate_user))"}, {"_type": "tag", "name": "leaderboard", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def leaderboard():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "login", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def login(form_data: OAuth2PasswordRequestForm = Depends()):$/", "language": "Python", "kind": "function", "signature": "(form_data: OAuth2PasswordRequestForm = Depends())"}, {"_type": "tag", "name": "make_move", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def make_move(move: MoveRequest, user=Depends(authenticate_user)):$/", "language": "Python", "kind": "function", "signature": "(move: MoveRequest, user=Depends(authenticate_user))"}, {"_type": "tag", "name": "oauth2_scheme", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^oauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"login\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "password", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    password: str = Field(..., min_length=6, description=\"Password (min 6 chars)\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "UserRegister", "scopeKind": "class"}, {"_type": "tag", "name": "pwd_context", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^pwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "register", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def register(user: UserRegister):$/", "language": "Python", "kind": "function", "signature": "(user: UserRegister)"}, {"_type": "tag", "name": "token_type", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    token_type: str = \"bearer\"$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "TokenResponse", "scopeKind": "class"}, {"_type": "tag", "name": "username", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    username: str = Field(..., min_length=3, max_length=30, description=\"Unique username\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "UserRegister", "scopeKind": "class"}, {"_type": "tag", "name": "verify_password", "path": "/home/kavia/workspace/code-generation/persistent-tic-tac-toe-802fe9dd/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def verify_password(plain_password: str, hashed_password: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(plain_password: str, hashed_password: str)"}], "hash": "a6e42b82e672f781464b738324bfdee8", "format-version": 4, "code-base-name": "tic_tac_toe_backend", "filename": "tic_tac_toe_backend/src/api/main.py", "fields": [{"name": "Dict[str, dict] GAMES", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str, int] LEADERBOARD", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str, str] TOKENS", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str, dict] USERS", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "int board_size", "scope": "GameCreateRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "oauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"login\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str password", "scope": "UserRegister", "scopeKind": "class", "description": "unavailable"}, {"name": "pwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str token_type", "scope": "TokenResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str username", "scope": "UserRegister", "scopeKind": "class", "description": "unavailable"}]}